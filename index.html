<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>E1C æ™ºæ…§åº§ä½èˆ‡é»åç³»çµ±</title>
    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --bg-color: #f4f7f6;
        }

        body { font-family: -apple-system, sans-serif; background: var(--bg-color); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        /* é ‚éƒ¨æ§åˆ¶å° */
        .header-info { text-align: center; margin-bottom: 10px; }
        .stats { background: #333; color: white; padding: 5px 15px; border-radius: 20px; font-size: 14px; margin-bottom: 10px; display: none; }

        .toolbar { width: 100%; max-width: 500px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; }
        
        button { padding: 12px 5px; font-size: 14px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-random { background: var(--success-color); }
        .btn-reset { background: var(--danger-color); }
        .btn-rollcall { background: var(--primary-color); grid-column: span 2; }
        .btn-exit-rc { background: #6c757d; grid-column: span 2; display: none; }

        /* åº§ä½è¡¨ä½ˆå±€ */
        .classroom-container { background: white; padding: 15px; border: 2px solid #333; position: relative; width: 98%; box-sizing: border-box; border-radius: 8px; }
        .top-door { position: absolute; top: -2px; left: 15px; border: 2px solid #333; border-top: none; padding: 2px 10px; background: white; font-size: 10px; font-weight: bold; }

        .classroom { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        @media (min-width: 600px) { .classroom { grid-template-columns: repeat(8, 1fr); } }
        
        .seat { border: 1px solid #ddd; aspect-ratio: 1 / 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; border-radius: 4px; position: relative; transition: 0.2s; }
        .seat.occupied { border-color: #333; }
        
        /* é»åç‹€æ…‹é¡è‰² */
        .seat.present { background-color: #d4edda !important; border-color: #28a745 !important; }
        .seat.absent { background-color: #f8d7da !important; border-color: #dc3545 !important; }

        .seat-num { position: absolute; top: 2px; left: 2px; font-size: 8px; color: #bbb; }
        .name { font-weight: bold; font-size: 13px; }
        .std-id { font-size: 8px; color: #999; }
        .plus { font-size: 20px; color: #eee; }

        .bottom-area { display: flex; flex-direction: column; align-items: center; margin-top: 15px; gap: 8px; }
        .blackboard { width: 80%; text-align: center; font-size: 16px; font-weight: bold; border-top: 3px solid #333; padding-top: 5px; }
        .info-row { display: flex; justify-content: space-between; width: 100%; font-size: 10px; font-weight: bold; }
        .computer { border: 1px dashed #333; padding: 3px 8px; }
        .door-label { border: 2px solid #333; padding: 3px 8px; }
    </style>
</head>
<body>

    <div class="header-info">
        <h2>ğŸ« E1C åº§ä½é»åç³»çµ±</h2>
        <div id="stats" class="stats">å‡ºå¸­äººæ•¸ï¼š<span id="p-count">0</span> / 56</div>
    </div>

    <div class="toolbar">
        <button id="btn-rand" class="btn-random" onclick="fillRandom()">ğŸ² éš¨æ©Ÿæ’åˆ—</button>
        <button id="btn-rst" class="btn-reset" onclick="resetAll()">ğŸ§¹ æ¸…ç©º</button>
        <button id="btn-rc" class="btn-rollcall" onclick="toggleRollCall(true)">ğŸ“ é€²å…¥é»åæ¨¡å¼</button>
        <button id="btn-exit" class="btn-exit-rc" onclick="toggleRollCall(false)">âŒ é€€å‡ºé»åæ¨¡å¼ (ä¿å­˜çµæœ)</button>
    </div>

    <div class="classroom-container">
        <div class="top-door">DOOR</div>
        <div class="classroom" id="grid"></div>
        <div class="bottom-area">
            <div class="blackboard">BLACKBOARD</div>
            <div class="info-row">
                <div class="door-label">DOOR</div>
                <div class="computer">COMPUTER</div>
            </div>
        </div>
    </div>

    <script>
        const allStudents = [
            {id:"1114300121", n:"é¾”æ˜±ç‘„", e:"Kelly"}, {id:"1114300122", n:"ä½™æ²›å®¹", e:"Melody"}, {id:"1114300123", n:"é™³æ¹˜ç”¯", e:"Ariel"}, {id:"1114300124", n:"æ—æ²æ¦†", e:"Amber"}, {id:"1114300125", n:"è•­ç¾½å½¤", e:"Amelia"}, {id:"1114300126", n:"æ—å¥•å¸†", e:"Ivan"}, {id:"1114300127", n:"é™³ä¹™ç‘„", e:"Sharon"}, {id:"1114300128", n:"ç‹æ¼†å¦¤", e:"Zoie"}, {id:"1114300129", n:"é™³éœå®œ", e:"Luna"}, {id:"1114300130", n:"é™³ç¥‰æ©", e:"Bianca"}, {id:"1114300131", n:"é™³åˆç‘„", e:"Christy"}, {id:"1114300132", n:"è³´å®¥ç’‡", e:"Alina"}, {id:"1114300133", n:"é™³çŸæ…ˆ", e:"Emily"}, {id:"1114300134", n:"æ±ŸèŠ¯èª", e:"Ina"}, {id:"1114300135", n:"é™³ä¸–è±ª", e:"Howard"}, {id:"1114300136", n:"æ›¾å®‰å²‘", e:"Ann"}, {id:"1114300137", n:"è³´ç‘¾å®‰", e:"Ashley"}, {id:"1114300138", n:"ç¾…å‡±çˆ¾", e:"Mikayeel"}, {id:"1114300139", n:"è¾›ä¿Šæ–‡", e:"Jun-wen"}, {id:"1114300140", n:"é»ƒé–æ™", e:"Amber"}, {id:"1114300141", n:"æ—ç´«é¨", e:"Nancy"}, {id:"1114300142", n:"å³éœˆç‘œ", e:"Yuri"}, {id:"1114300143", n:"è¨±å”¯èŠ¯", e:"Una"}, {id:"1114300144", n:"éŠèŠ¯èª", e:"Abby"}, {id:"1114300145", n:"ææ˜“æ˜Œ", e:"Jason"}, {id:"1114300146", n:"æå©•ç¦•", e:"Eve"}, {id:"1114300147", n:"ææ©å¦®", e:"Miu Miu"}, {id:"1114300148", n:"æ—é‡‘å§µ", e:"Linda"}, {id:"1114300149", n:"é™³å¯ç´œ", e:"Amber"}, {id:"1114300151", n:"å¼µé›…çŸ", e:"Judy"}, {id:"1114300152", n:"ç‰›æ˜±ç¿”", e:"Sean"}, {id:"1114300153", n:"é™³ä»¥å©•", e:"Emma"}, {id:"1114300154", n:"å¼µéˆºå©•", e:"Wendy"}, {id:"1114300155", n:"æœ±é›¯èŠ³", e:"Mia"}, {id:"1114300156", n:"é€£å­ç”¯", e:"Liliya"}, {id:"1114300157", n:"æ¥ŠèŠ·èŠ¹", e:"Alex"}, {id:"1114300158", n:"é™³ç¦æ¶µ", e:"Hannah"}, {id:"1114300159", n:"é™³å† å®‡", e:"Benson"}, {id:"1114300160", n:"é™³æ¼¢åº­", e:"Lina"}, {id:"1114300161", n:"å¼µä¹™èŠ¹", e:"Irene"}, {id:"1114300162", n:"ç‹å¦è»", e:"Grace"}, {id:"1114300163", n:"æ›²å­å¯¬", e:"Miller"}, {id:"1114300164", n:"ç‹ä»¥å€«", e:"Juan Jose"}, {id:"1114300165", n:"è¶™äºå«»", e:"Abby"}, {id:"1114300166", n:"æ—å®œæ¨º", e:"Novalie"}, {id:"1114300167", n:"æŸ¯å“ç‘€", e:"Pamela"}, {id:"1114300168", n:"å“å½¥å‡", e:"Cynthia"}, {id:"1114300169", n:"éŠæ¢å¥é›…", e:"Luna"}, {id:"1114300170", n:"å¼µå­ç‘œ", e:"Yvonne"}, {id:"1114300171", n:"å¼µæ¹˜ç¿Š", e:"Cecelia"}, {id:"1114300172", n:"å»–éšè–‡", e:"Nicole"}, {id:"1114300173", n:"é»ƒæ¯“éœ", e:"Lily"}, {id:"1114300174", n:"è”¡æ‚…ç³", e:"Lina"}, {id:"1114300175", n:"é™³å®¥å‰", e:"Iris"}, {id:"1114300501", n:"è³ˆä¼¯ç", e:"Haein"}, {id:"1114300502", n:"é„­çš“è»’", e:"Suppakarn"}
        ];

        let seatMap = JSON.parse(localStorage.getItem('e1c_seats')) || new Array(56).fill(null);
        let rollCallMode = false;

        function save() {
            localStorage.setItem('e1c_seats', JSON.stringify(seatMap));
        }

        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            let presentCount = 0;

            for (let i = 0; i < 56; i++) {
                const student = seatMap[i];
                const seatDiv = document.createElement('div');
                seatDiv.className = 'seat' + (student ? ' occupied' : '');
                
                // é»åé¡è‰²é‚è¼¯
                if (student && student.status === 'present') {
                    seatDiv.classList.add('present');
                    presentCount++;
                } else if (student && student.status === 'absent') {
                    seatDiv.classList.add('absent');
                }

                seatDiv.onclick = () => rollCallMode ? markStudent(i) : handleSeatClick(i);
                
                let content = `<div class="seat-num">${(i%8)+1}-${7-Math.floor(i/8)}</div>`;
                if (student) {
                    content += `<div class="std-id">${student.id.slice(-3)}</div><div class="name">${student.n}</div>`;
                } else {
                    content += `<div class="plus">+</div>`;
                }
                seatDiv.innerHTML = content;
                grid.appendChild(seatDiv);
            }
            document.getElementById('p-count').innerText = presentCount;
        }

        function handleSeatClick(index) {
            const query = prompt("è¼¸å…¥å§“åæˆ–å­¸è™Ÿæœ«ä¸‰ç¢¼ï¼š");
            if (query === null) return;
            if (query === "") { seatMap[index] = null; save(); initGrid(); return; }

            const student = allStudents.find(s => s.n.includes(query) || s.id.endsWith(query));
            if (!student) return alert("æ‰¾ä¸åˆ°åŒå­¸ï¼");

            const oldIdx = seatMap.findIndex(s => s && s.id === student.id);
            if (oldIdx !== -1) seatMap[oldIdx] = null;
            
            seatMap[index] = {...student, status: 'unknown'};
            save();
            initGrid();
        }

        function toggleRollCall(on) {
            rollCallMode = on;
            document.getElementById('btn-rand').style.display = on ? 'none' : 'block';
            document.getElementById('btn-rst').style.display = on ? 'none' : 'block';
            document.getElementById('btn-rc').style.display = on ? 'none' : 'block';
            document.getElementById('btn-exit').style.display = on ? 'block' : 'none';
            document.getElementById('stats').style.display = on ? 'block' : 'none';
            if(!on) save(); 
            initGrid();
        }

        function markStudent(index) {
            if (!seatMap[index]) return;
            // ç‹€æ…‹åˆ‡æ›ï¼šæœªçŸ¥ -> å‡ºå¸­ -> ç¼ºå¸­ -> æœªçŸ¥
            const s = seatMap[index];
            if (!s.status || s.status === 'unknown') s.status = 'present';
            else if (s.status === 'present') s.status = 'absent';
            else s.status = 'unknown';
            
            initGrid();
        }

        function fillRandom() {
            const occupiedIds = seatMap.filter(s => s !== null).map(s => s.id);
            let pool = allStudents.filter(s => !occupiedIds.includes(s.id));
            pool.sort(() => Math.random() - 0.5);

            let poolIdx = 0;
            for (let i = 0; i < 56; i++) {
                if (seatMap[i] === null && poolIdx < pool.length) {
                    seatMap[i] = {...pool[poolIdx++], status: 'unknown'};
                }
            }
            save();
            initGrid();
        }

        function resetAll() {
            if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰åº§ä½èˆ‡é»åç´€éŒ„å—ï¼Ÿ")) {
                seatMap = new Array(56).fill(null);
                localStorage.removeItem('e1c_seats');
                initGrid();
            }
        }

        initGrid();
    </script>
</body>
</html>
